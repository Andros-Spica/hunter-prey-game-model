---
title: "Hunting Bout model - scenarios"
author: "Andreas Angourakis"
format: html
editor: visual
---

```{r}
library(tidyr)
library(dplyr)
library(readr)
library(ggplot2)
library(gridExtra)
library(scales)
```

```{r}
source("library/bifurcationPlot.R")
source("library/tripleRaster_twoParameters.R")
source("library/tripleRaster_fourParameters.R")
```

## Load experiment data

Define path to files:

```{r}
output_dir <- "output/"
experiment_prefix <- "huntingBout experiment-"
experiment_name <- "scenarios"
```

Load experiment data from file generated by Behavior Space:

```{r}
exp_scenarios <- read.csv(paste0(output_dir, experiment_prefix, experiment_name, "-table.csv"), skip = 6)
```

```{r}
exp_scenarios <- exp_scenarios %>%
  rename(run_number = X.run.number.) %>%
  rename(step = X.step.) %>%
  rename(scenario_environment = scenario.environment) %>%
  rename(waypoints_to_prey_attractors = waypoints.to.prey.attractors) %>%
  mutate(was_bout_successful = ifelse(was.bout.successful == "true", TRUE, FALSE)) %>%
  mutate(parameter_config = paste0("height [", par_hunters_height_min, ", ", par_hunters_height_max, " prey"))

exp_scenarios_long <- exp_scenarios %>%
  select(SEED, scenario_environment, par_hunters_height_max, was_bout_successful) %>%
  pivot_longer(cols = c(scenario_environment), names_to = "parameter", values_to = "value")

exp_scenarios_short <- exp_scenarios %>%
  group_by(scenario_environment, waypoints_to_prey_attractors) %>%
  summarise(success_rate = mean(was_bout_successful), .groups = "keep")
```

Load trajectories:

## Overview

```{r}
table(exp_scenarios$scenario_environment)
```

```{r}
table(exp_scenarios$scenario_environment, exp_scenarios$prey.attractor.probability)
```

```{r}
table(exp_scenarios$scenario_environment, exp_scenarios$init.obstacle.scale)
```

```{r}
table(exp_scenarios$scenario_environment, exp_scenarios$init.obstacle.frequency)
```

```{r}
table(exp_scenarios$scenario_environment, exp_scenarios$waypoints.to.prey.attractors)
```


## Plot

```{r}
ggplot(exp_scenarios) +
  geom_boxplot(aes(x = scenario_environment, y = was_bout_successful))
```

```{r}
ggplot(exp_scenarios_short, aes(x = scenario_environment, y = success_rate)) + geom_point()
```

```{r}
plotName <- "plots/scenarios-success-rate.png" 
png(plotName, height = 600, width = 800)
ggplot(exp_scenarios_short,
       aes(x = scenario_environment, 
           y = success_rate)) +
  geom_col() +
  labs(x = "scenario", y = "success rate") +
  theme(
    axis.title = element_text(size = 15),
    axis.text = element_text(size = 15)
  )
dev.off()
```

```{r}
knitr::include_graphics(plotName)
```

```{r}
plotName <- "plots/scenarios-waypoint-to-attractor-success-rate.png" 
png(plotName)
ggplot(exp_scenarios_short,
       aes(x = waypoints_to_prey_attractors, 
           y = scenario_environment)) +
  geom_raster(aes(fill = success_rate)) +
  labs(x = "waypoint to attractors", y = "scenario", fill = "success rate")
dev.off()
```

```{r}
knitr::include_graphics(plotName)
```

```{r}
plotName <- "plots/scenarios-events.png" 
png(plotName, width = 800, height = 200)
tripleRaster_twoParameters(
  exp_scenarios,
  parameter_x = "scenario_environment",
  parameter_y = "par_hunters_height_max",
  variable_1 = "pursues",
  variable_2 = "sneaks",
  variable_3 = "shots",
  parameter_x_label = "scenario",
  parameter_y_label = "",
  variable_1_label = "pursues",
  variable_2_label = "sneaks",
  variable_3_label = "shots",
  plot_scale = 5,
  variable_2_point_size = 5,
  variable_3_point_number_legend_keys = 3,
  variable_3_print_values = FALSE,
  legend_title_size = 3,
  legend_text_size = 2,
  variable_3_point_size = c(0.2, 3)) +
  theme(axis.text.y = element_blank(), legend.position = "bottom", legend.key.width = unit(1.2, "cm"))
dev.off()
```

```{r}
knitr::include_graphics(plotName)
```

```{r}
plotName <- "plots/scenarios-waypoints-to-attractor-events.png" 
png(plotName, width = 800, height = 400)
tripleRaster_twoParameters(
  exp_scenarios,
  parameter_x = "scenario_environment",
  parameter_y = "waypoints_to_prey_attractors",
  variable_1 = "pursues",
  variable_2 = "sneaks",
  variable_3 = "shots",
  parameter_x_label = "scenario",
  parameter_y_label = "waypoints to prey attractors",
  variable_1_label = "pursues",
  variable_2_label = "sneaks",
  variable_3_label = "shots",
  plot_scale = 5,
  variable_2_point_size = 5,
  variable_3_point_number_legend_keys = 3,
  variable_3_print_values = FALSE,
  legend_title_size = 3,
  legend_text_size = 2,
  variable_3_point_size = c(0.2, 3)) +
  theme(legend.position = "bottom", legend.key.width = unit(1.2, "cm"))
dev.off()
```

```{r}
knitr::include_graphics(plotName)
```
